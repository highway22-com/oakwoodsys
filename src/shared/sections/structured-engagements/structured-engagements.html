<section
  class="w-full bg-gradient-to-b from-slate-900 via-blue-900 to-slate-900 min-h-screen overflow-x-hidden relative"
  aria-labelledby="structured-engagements-title"
>
  <div class="absolute inset-0 structured-engagements__bg-base"></div>
  <div
    class="absolute inset-0 structured-engagements__bg-image"
    style="
      background-image: url(&quot;/assets/structured-engagement-bg.jpg&quot;);
    "
  ></div>
  <div class="absolute inset-0 structured-engagements__bg-top-dark"></div>

  <div class="px-4 sm:px-6 md:px-8 lg:px-18 relative z-10 py-12">
    <div class="text-center mb-8 sm:mb-10 md:mb-12">
      <p class="text-base uppercase tracking-wider text-p-200 pb-4">
        {{ section().label }}
      </p>
      <h2
        id="structured-engagements-title"
        class="text-xl sm:text-4xl md:text-5xl lg:text-5xl text-white mb-6 sm:mb-8 md:mb-10"
      >
        {{ getTitle(section()) }}
      </h2>
      @if (section().tabs?.length) {
        <div
          #tabList
          class="structured-tabs flex w-full justify-start lg:justify-center gap-4 sm:gap-6 mb-8 sm:mb-10 md:mb-12 overflow-x-auto whitespace-nowrap pb-2"
        >
          @for (tab of section().tabs; track tab) {
            <button
              #tabButton
              type="button"
              class="structured-tabs__button"
              [attr.data-tab]="tab"
              [ngClass]="
                getTabClasses(tab, activeTab() ?? undefined) +
                ' text-base sm:text-lg shrink-0'
              "
              (click)="onTabClick(tab)"
            >
              {{ tab }}
            </button>
          }
          <div
            class="structured-tabs__underline"
            [style.background]="'#32A3FA'"
            [style.left.px]="underlineLeft()"
            [style.width.px]="underlineWidth()"
            [style.opacity]="underlineVisible() ? 1 : 0"
          ></div>
        </div>
      }
    </div>
    <div
      class="flex flex-nowrap overflow-x-auto md:overflow-x-visible md:flex-none md:grid md:grid-cols-2 lg:grid-cols-4 gap-6 sm:gap-8 mb-8 sm:mb-10 transition-opacity duration-200 ease-out"
      style="-webkit-overflow-scrolling: touch; scroll-snap-type: x mandatory;"
      [class.structured-engagements__cards-enter]="cardsVisible()"
      [style.opacity]="cardsVisible() ? 1 : 0"
      [style.transform]="'translateY(0)'"
    >
      @for (offer of filteredOffers(); track offer.id || $index) {
        <div
          class="structured-engagements__card structured-engagements__card-border group cursor-pointer rounded-md min-w-[240px] sm:min-h-[300px] md:min-w-0 md:min-h-0 md:min-h-[unset] md:min-w-[unset]"
          [attr.data-border]="normalizeBorderColor(offer.borderColor)"
          [ngClass]="getOfferCardClasses(offer.borderColor, $index)"
        >
          <div
            class="relative h-full p-6 sm:p-8 flex flex-col structured-engagements__card-surface"
          >
            <div
              class="flex w-[55px] h-[55px] text-3xl items-center justify-center structured-engagements__icon-container"
              [ngClass]="getOfferIconBgClass(offer.borderColor)"
            >
              @if (offer.svgIcon) {
                <div
                  class="structured-engagements__svg-icon w-full h-full"
                  [innerHTML]="getSafeSvgIcon(offer.svgIcon)"
                ></div>
              } @else {
                <i
                  [class]="
                    'fa-solid fa-' +
                    (offer.icon || 'circle-nodes') +
                    ' ' +
                    getIconColor(offer.borderColor)
                  "
                ></i>
              }
            </div>
            <h3 class="text-base sm:text-lg text-white/90 pt-10 pb-4">
              {{ offer.title }}
            </h3>
            <p
              class="text-sm sm:text-[13px] text-gray-300 mb-3 font-segoe pb-2"
              style="line-height: 140%"
            >
              {{ offer.description }}
            </p>
            @if (offer.link) {
              <a
                [href]="offer.link"
                class="mt-auto self-start text-sm sm:text-base text-gray-300 hover:text-white transition-colors duration-200 inline-flex items-center"
              >
                {{ offer.linkText ?? "Learn more" }}
                <svg
                  class="ml-2"
                  width="8"
                  height="13"
                  viewBox="0 0 8 13"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M0.984375 12.332C0.738281 12.332 0.519531 12.25 0.355469 12.0859C0 11.7578 0 11.1836 0.355469 10.8555L4.97656 6.20703L0.355469 1.58594C0 1.25781 0 0.683594 0.355469 0.355469C0.683594 0 1.25781 0 1.58594 0.355469L6.83594 5.60547C7.19141 5.93359 7.19141 6.50781 6.83594 6.83594L1.58594 12.0859C1.42188 12.25 1.20312 12.332 0.984375 12.332Z"
                    fill="white"
                  />
                </svg>
              </a>
            }
          </div>
        </div>
        <!-- Desktop: Button in grid position -->
        @if ($index === 0 && section().cta) {
          <div class="hidden lg:block lg:col-start-1 lg:row-start-2">
            <div class="bg-p-700 inline-block mb-3">
              <app-button-primary
                [text]="section().cta?.text ?? ''"
                [link]="section().cta?.link ?? '/structured-engagement'"
              />
            </div>
          </div>
        }
      }
  
      
    </div>
        <!-- Mobile: Button at the very bottom, full width, after all cards -->
       @if (section().cta) {
        <div class="block lg:hidden w-[30px] mt-4 sm:row-start-2">
          <div class="bg-p-700 inline-block w-full">
            <app-button-primary
              [text]="section().cta?.text ?? ''"
              [link]="section().cta?.link ?? '/structured-engagement'"
            />
          </div>
        </div>
      } 
  </div>
</section>
